import { Injectable } from '@angular/core';
import { Place } from './place.model';
import { BehaviorSubject } from 'rxjs';
import { AuthService } from '../auth/auth.service';
import { take, filter, map, switchMap, tap } from 'rxjs/operators';
import { HttpClient } from '@angular/common/http';

interface placeData {
  availableFrom: string;
  availableTo: string;
  description: string;
  imageUrl: string;
  price: number;
  title: string;
  userId: string;
}

@Injectable({
  providedIn: 'root'
})
export class PlacesService {

  // initializing a new place with an empty place object
  private _places = new BehaviorSubject<Place[]>([ new Place() ]);

  constructor( private authSrvc: AuthService, private http: HttpClient) { }

  // Fetch offers from db

  fetchPlaces() {
    return this.http.get<{ [key: string]: placeData }>('https://ionic-bnb-f2db2.firebaseio.com/offered.json')
    .pipe(
      map( resData => {
        const places = [];
        for ( const key in resData) {
          if ( resData.hasOwnProperty(key)) {
              places.push(new Place(
                key,
                resData[key].title,
                resData[key].description,
                resData[key].imageUrl,
                resData[key].price,
                new Date(resData[key].availableFrom),
                new Date(resData[key].availableTo),
                resData[key].userId
                )
              );
          }
        }
        return places;
      }),
      tap( places => {
        this._places.next(places);
      })
    );
  }

  get places() {
    return this._places.asObservable();
  }

  getPlace(id: string){

    return this.places.pipe(take(1), map( places => {
      return { ...places.find(p => p.id == id)};
    }));
    // return { ...this._places.find(p => p.id == id)};
  }

  addPlace(
    title: string,
    description: string,
    price: number,
    dateFrom: Date,
    dateTo: Date ){

      let generatedId: string;

      const newPlace =  new Place(
        Math.random().toString(),
        title,
        description,
        'data:image/jpeg;base64,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',
        price,
        dateFrom,
        dateTo,
        this.authSrvc.userId
      );


      console.log('About to save an offer...');

      return this.http.post<{name: string}>('https://ionic-bnb-f2db2.firebaseio.com/offered.json',
      { ...newPlace, id: null  })
      .pipe(
        switchMap(resData => {
          generatedId = resData.name;
          return this.places; // subscribes to a new observable and cancels previous observable
        }),
        take(1),
        tap( places => {
          newPlace.id = generatedId;
          this._places.next(places.concat(newPlace));
        })
      );


  }

}
